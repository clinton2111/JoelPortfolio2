angular.module("joelDashBoard.DashCtrl",[]).controller("dashboardController",["$scope","store","API","Insert","Search","Update","Delete","$state",function(e,t,n,r,i,s,o,u){var a;return a=function(){return $(".button-collapse").sideNav(),$(".materialboxed").materialbox()},e.gPlace,e.$on("$viewContentLoaded",a),e.user=t.get("user"),e.dpUrl=n.url+"pic.php?id="+e.user.id+"&&from=users",e.picUrl={photo:n.url+"../../assets/images/photos/",gig:n.url+"../../assets/images/gigs/"},e.toggleEdit=function(t){var n,r;return r=_.findIndex(e.gigs,{id:t}),$(".datepicker").pickadate({container:"body",selectMonths:!0,selectYears:15,format:"dd-mm-yyyy"}),n=e.gigs[r],n.fb_link==="#"&&(n.fb_link=""),e["new"]={title:n.title,place:n.address,fbLink:n.fb_link,lat:n.lat,lng:n.lng},document.getElementById("new_date-"+t).value=moment(n.event_date,"DD-MM-YYYY").format("DD-MM-YYYY")},e.fetchPhotos=function(){return i.fetchPhotos().then(function(t){var n;n=t.data;if(n.status==="Success")return e.photos=n.results},function(e){return Materialize.toast("Something went wrong",4e3)})},e.fetchGigs=function(){return i.fetchGigs().then(function(t){var n;n=t.data;if(n.status==="Success")return e.gigs=n.results},function(e){return Materialize.toast("Something went wrong",4e3)})},e.openPhotoModal=function(){return $("input#caption").characterCounter(),$("#photoModal").openModal()},e.openGigModal=function(){return $(".datepicker").pickadate({container:"body",selectMonths:!0,selectYears:15,format:"dd-mm-yyyy"}),$("#gigModal").openModal()},e.openCaptionModal=function(t){var n,r;return r=_.findIndex(e.photos,{id:t}),n=e.photos[r].caption,n===""&&(n=null),e.currentPic={Caption:n,Id:t},$("#updateCaption").openModal()},e.uploadPhoto=function(t){return r.uploadPhoto(t).then(function(n){var r;return r=n.data,r.status==="Success"?(e.photos.unshift({id:r.id,caption:t.Caption,photo_image:r.imageName}),e.pic={},Materialize.toast(r.status+" - "+r.message,4e3)):Materialize.toast(r.status+" - "+r.message,4e3)},function(e){return Materialize.toast("Something went wrong",4e3)})},e.uploadGig=function(t){var n,i,s;return i=document.getElementById("date").value,_.isNull(t.fbLink)&&_.isUndefined(t.fbLink)&&_.isEmpty(t.fbLink)||(t.fbLink="#"),n={title:t.title,date:i,address:t.place,lat:t.placeDetails.geometry.location.lat(),lng:t.placeDetails.geometry.location.lng(),fbLink:t.fbLink},s=t.File[0],$("#photoModal").closeModal(),r.uploadGig(n,s).then(function(n){var r;return r=n.data,r.status==="Success"?(e.gigs.unshift({id:r.id,title:t.title,address:t.place,latitude:t.placeDetails.geometry.location.lat(),longitude:t.placeDetails.geometry.location.lng(),event_date:i,fb_link:t.fbLink,photo_image:r.imageName}),e.gig={},Materialize.toast(r.status+" - "+r.message,4e3)):Materialize.toast(r.status+" - "+r.message,4e3)},function(e){return Materialize.toast("Something went wrong",4e3)})},e.deletePhoto=function(t){var n,r;return r=_.findIndex(e.photos,{id:t}),n={id:t},o.deletePhoto(n).then(function(t){var n;return n=t.data,n.status==="Success"?(e.photos.splice(r,1),Materialize.toast(n.status+" - "+n.message,4e3)):Materialize.toast(n.status+" - "+n.message,4e3)},function(e){return Materialize.toast("Something went wrong",4e3)})},e.deleteGig=function(t){var n,r;return r=_.findIndex(e.gigs,{id:t}),n={id:t},o.deleteGig(n).then(function(t){var n;return n=t.data,n.status==="Success"?(e.gigs.splice(r,1),Materialize.toast(n.status+" - "+n.message,4e3)):Materialize.toast(n.status+" - "+n.message,4e3)},function(e){return Materialize.toast("Something went wrong",4e3)})},e.updatePoster=function(t,n){var r,i,o;if(!_.isUndefined(n.File[0]))return o=_.findIndex(e.gigs,{id:t}),i=n.File[0],r={updateType:"poster",id:t},s.updateGigPoster(r,i).then(function(t){var n;return n=t.data,n.status==="Success"?(e.gigs[o].photo_image=n.imageName,Materialize.toast(n.status+" - "+n.message,4e3)):Materialize.toast(n.status+" - "+n.message,4e3)},function(e){return Materialize.toast("Something went wrong",4e3)})},e.updateGig=function(t,n){var r,i,o,u,a;return i=document.getElementById("new_date-"+t).value,o=_.findIndex(e.gigs,{id:t}),_.isNull(n.fbLink)&&_.isUndefined(n.fbLink)&&_.isEmpty(n.fbLink)||(n.fbLink="#"),typeof n.placeDetails=="undefined"?(u=e.gigs[o].latitude,a=e.gigs[o].longitude):(u=n.placeDetails.geometry.location.lat(),a=n.placeDetails.geometry.location.lng(),console.log("there")),r={title:n.title,date:i,address:n.place,lat:u,lng:a,fbLink:n.fbLink,id:t},s.updateGigInfo(r).then(function(r){var s;return s=r.data,s.status==="Success"?(e.gigs[o]={id:t,title:n.title,address:n.place,latitude:u,longitude:a,event_date:i,fb_link:n.fbLink,photo_image:e.gigs[o].photo_image},Materialize.toast(s.status+" - "+s.message,4e3)):Materialize.toast(s.status+" - "+s.message,4e3)},function(e){return Materialize.toast("Something went wrong",4e3)})},e.updateCaption=function(t){var n,r,i;return r=_.findIndex(e.photos,{id:t}),i=e.currentPic.Caption,n={caption:i,id:t},s.updateCaption(n).then(function(t){var n;return n=t.data,n.status==="Success"?(e.photos[r].caption=i,Materialize.toast(n.status+" - "+n.message,4e3)):Materialize.toast(n.status+" - "+n.message,4e3)},function(e){return Materialize.toast("Something went wrong",4e3)})},e.logout=function(){return t.remove("user"),u.go("auth",{type:"login",email:null,value:null}),Materialize.toast("You have been logged out",4e3)},e.$watchCollection(["photos","gigs"],function(){return e.$apply},!1)}]);